@PART[*]:HAS[#CrewCapacity[>0],!MODULE[IonModuleCrewSupport]]:FOR[IoncrossCrewSupport]
{
    MODULE
    {
		name = IonModuleCrewSupport
    }
    RESOURCE
    {
		name = Oxygen
		amount = 850
		maxAmount = 850
		@amount *= #$/CrewCapacity$
		@maxAmount *= #$/CrewCapacity$
    }
    RESOURCE
    {
		name = CarbonDioxide
		amount = 0
		maxAmount = 200
		@maxAmount *= #$/CrewCapacity$
    }
	IONCROSS_AUTO_PROCESSING = true
}
// these need to be :FINAL to ensure that our resources aren't being smashed by other configs
@PART[*]:HAS[@MODULE[IonModuleCrewSupport],@MODULE[ModuleFuelTanks],@RESOURCE[ElectricCharge]]:NEEDS[RealFuels]:FINAL
{
	IonTankVolume = 0 //1050
	//@IonTankVolume *= #$/CrewCapacity$
	//@IonTankVolume /= 200 // RF ServiceModule utilization for O2
	@IonTankVolume += #$/RESOURCE[Oxygen]/maxAmount$
	@IonTankVolume += #$/RESOURCE[CarbonDioxide]/maxAmount$
	@IonTankVolume /= 200
	electricChargeVolume = #$/RESOURCE[ElectricCharge]/maxAmount$
	@electricChargeVolume /= 1000
	@IonTankVolume += #$electricChargeVolume$ // taken from Stockalike RF for ElectricCharge
	@MODULE[ModuleFuelTanks]
	{
		%type = ServiceModule
		%basemass = -1
		@volume += #$/IonTankVolume$
		TANK
		{
			name = Oxygen
			amount = #$/RESOURCE[Oxygen]/maxAmount$
			maxAmount = #$/RESOURCE[Oxygen]/maxAmount$
			//@amount *= #$/CrewCapacity$
			//@maxAmount *= #$/CrewCapacity$
		}
		TANK
		{
			name = CarbonDioxide
			amount = 0
			maxAmount = #$/RESOURCE[CarbonDioxide]/maxAmount$
			//@maxAmount *= #$/CrewCapacity$
		}
		TANK
		{
			name = ElectricCharge
			amount = full
			maxAmount = #$/RESOURCE[ElectricCharge]/maxAmount$
			utilization = 1000
		}
	}
}
@PART[*]:HAS[@MODULE[IonModuleCrewSupport],@MODULE[ModuleFuelTanks],!RESOURCE[ElectricCharge]]:NEEDS[RealFuels]:FINAL
{
	IonTankVolume = 1050
	@IonTankVolume *= #$/CrewCapacity$
	@IonTankVolume /= 200 // RF ServiceModule utilization for O2
	@MODULE[ModuleFuelTanks]
	{
		%type = ServiceModule
		%basemass = -1
		@volume += #$/IonTankVolume$
		TANK
		{
			name = Oxygen
			amount = 850
			maxAmount = 850
			@amount *= #$/CrewCapacity$
			@maxAmount *= #$/CrewCapacity$
		}
		TANK
		{
			name = CarbonDioxide
			amount = 0
			maxAmount = 200
			@maxAmount *= #$/CrewCapacity$
		}
	}
}
// TODO Think about deleting these... what was I thinking adding MFT to parts that don't need it?
@PART[MAYBE.DELETE.THIS]:HAS[@MODULE[IonModuleCrewSupport],!MODULE[ModuleFuelTanks],!RESOURCE[ElectricCharge]]:NEEDS[RealFuels]:FINAL
{
	MODULE
	{
		name = ModuleFuelTanks
		type = ServiceModule
		volume = 1050
		basemass = -1
		@volume *= #$/CrewCapacity$
		@volume /= 200 // RF ServiceModule utilization for O2
		TANK
		{
			name = Oxygen
			amount = 850
			maxAmount = 850
			@amount *= #$/CrewCapacity$
			@maxAmount *= #$/CrewCapacity$
		}
		TANK
		{
			name = CarbonDioxide
			amount = 0
			maxAmount = 200
			@maxAmount *= #$/CrewCapacity$
		}
	}
}
@PART[*]:HAS[@MODULE[IonModuleCrewSupport],@MODULE[ModuleCommand],@RESOURCE[MonoPropellant],@RESOURCE[ElectricCharge],!MODULE[ModuleFuelTanks]]:NEEDS[RealFuels,RealFuels-Stockalike]:FINAL
{
	MODULE
	{
		name = ModuleFuelTanks
		type = ServiceModule
		volume = 1050
		basemass = -1
		@volume *= #$/CrewCapacity$
		@volume /= 200 // RF ServiceModule utilization for O2
		@volume += 3 // taken from Stockalike RF for ElectricCharge
		TANK
		{
			name = Oxygen
			amount = 850
			maxAmount = 850
			@amount *= #$/CrewCapacity$
			@maxAmount *= #$/CrewCapacity$
		}
		TANK
		{
			name = CarbonDioxide
			amount = 0
			maxAmount = 200
			@maxAmount *= #$/CrewCapacity$
		}
		TANK
		{
			name = ElectricCharge
			amount = full
			maxAmount = #$/RESOURCE[ElectricCharge]/maxAmount$
			utilization = 1000
		}
	}
}